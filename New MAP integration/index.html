<!DOCTYPE html>
<html>

<head>
  <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
  <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />

  <style>
    html,
    body,
    #map {
      margin: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script>
    const map = new maplibregl.Map({
      container: 'map',
      style: './style.json', // stylesheet location
      minZoom: 4,
      bounds: [13, 38, 35, 53],
      zoom: 5
    });
    const SOURCE_NAME = "abp-locuri";// custom name for the source
    const DATA_LAYER = "locuri"; // this is the name of the layer in the vector tile source

    const magazinFilter = ["all", ["==", "magazin", ["get", "tip"]], ["==", ["geometry-type"], "Point"]];
    const baltiFilter = ["all", ["==", "balta", ["get", "tip"]], ["==", ["geometry-type"], "Polygon"]];
    const baltiPointFilter = ["all", ["==", "balta", ["get", "tip"]], ["==", ["geometry-type"], "Point"]];
    const apeLacuriFilter = ["all", ["==", "apa", ["get", "tip"]], ["==", ["geometry-type"], "Polygon"]];
    const apeRauriFilter = ["all", ["==", "apa", ["get", "tip"]], ["==", ["geometry-type"], "LineString"]];
    const apePointFilter = ["all", ["==", "apa", ["get", "tip"]], ["==", ["geometry-type"], "Point"]];

    map.on("load", () => {
      map.addSource(SOURCE_NAME, {
        type: "vector",
        tiles: ["https://api.mapcherry.io/tiles/{{username}}/{{dataset_key}}/{z}/{x}/{y}.pbf?key={{map_token}}"],
        maxzoom: 14,
        bounds: [20.22, 43.4, 29.7, 48.3],
        promoteId: "id"
      });
      /* point-magazin */
      map.addLayer({
        id: "point-magazin",
        type: "circle",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        filter: magazinFilter,

        paint: {
          "circle-color": "#AAA",//["case", ["to-boolean", ["get", "published"]], "#0475c1", "#AAA"],
          "circle-stroke-width": 2,
          "circle-stroke-color": "rgba(250, 247, 247, 1)",
          "circle-radius": 6
        },
      });

      /* APE PUBLICE */
      map.addLayer({
        id: "polygon-ape-publice",
        type: "fill",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        filter: apeLacuriFilter,
        minzoom: 8,
        paint: {
          "fill-color": [
            "case",
            ["boolean", ["feature-state", "selected"], false],
            "rgba(239, 111, 108, 1)",
            ["boolean", ["get", "pescuit_interzis"], false],
            "rgba(233, 56, 53, 1)",
            "rgba(7, 91, 139, 1)",
          ],
          "fill-opacity": [
            "case",
            ["boolean", ["feature-state", "selected"], false],
            0.7,
            ["boolean", ["get", "pescuit_interzis"], false],
            1,
            0.7,
          ],
          "fill-outline-color": [
            "case",
            ["boolean", ["feature-state", "selected"], false],
            "rgba(239, 111, 108, 1)",
            ["boolean", ["get", "pescuit_interzis"], false],
            "rgba(233, 56, 53, 1)",
            "#075B8B",
          ]
        }
      }, "roads-track");

      map.addLayer({
        id: "line-ape-publice",
        type: "line",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        filter: apeRauriFilter,
        minzoom: 8,
        layout: {
          "line-cap": "round",
          "line-join": "bevel",
        },
        paint: {
          "line-color": [
            "case",
            ["boolean", ["feature-state", "selected"], false],
            "rgba(239, 111, 108, 1)",
            ["boolean", ["get", "pescuit_interzis"], false],
            "rgba(233, 56, 53, 1)",
            "rgba(7, 91, 139, 1)",
          ],

          "line-width": { type: "exponential", stops: [[8, 2], [12, 4]] },
          "line-opacity": 0.7,
        }
      }, "roads-track");
      map.addLayer({
        id: "line-ape-publice-cast",
        type: "line",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        filter: apeRauriFilter,
        minzoom: 8,
        layout: {
          "line-cap": "round",
          "line-join": "bevel",
        },
        paint: {
          "line-color": "rgba(7, 91, 139, 1)",
          "line-width": { type: "exponential", stops: [[8, 8], [12, 16], [14, 32]] },
          "line-opacity": 0,
        }
      }, "roads-track");


      /* pointlabel-ape-publice */
      map.addLayer({
        id: "pointlabel-ape-publice",
        type: "symbol",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        filter: apePointFilter,
        minzoom: 8,
        layout: {
          "text-font": ["Roboto Black"],
          "text-field": "{nume}",
          "text-size": {
            type: "exponential",
            stops: [[8, 9], [18, 15]]
          },
          "text-allow-overlap": false,
          "text-ignore-placement": false,
          "text-letter-spacing": 0.1,
          "text-anchor": "top",
          "text-rotate": 0,
          "text-transform": "none",
          "text-offset": [0, 1]
        },
        paint: {
          "text-color": "rgba(0, 61, 132, 1)",
          "text-halo-color": "rgba(247, 246, 246, 1)",
          "text-halo-width": 0.7
        }
      });

      /* point-ape-publice */
      map.addLayer({
        id: "point-ape-publice",
        type: "circle",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        filter: apePointFilter,

        paint: {
          "circle-color":
            [
              "case",
              ["boolean", ["get", "pescuit_interzis"], false],
              "rgba(233, 56, 53, 1)",
              "rgba(239, 111, 108, 1)",
            ],
          "circle-stroke-width": 2,
          "circle-stroke-color": "rgba(250, 247, 247, 1)",
          "circle-radius": 6
        }
      });

      /* linelabel-ape-publice */
      map.addLayer({
        id: "linelabel-ape-publice",
        type: "symbol",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        filter: apeRauriFilter,
        layout: {
          "text-font": ["Roboto Condensed Light"],
          "text-field": "{nume}",
          "text-size": { type: "exponential", stops: [[14, 9], [18, 13]] },
          "symbol-placement": "line",
          "text-allow-overlap": false,
          "text-ignore-placement": false,
          "text-offset": [0, -1],
          "text-letter-spacing": 0.1,
          "text-justify": "auto",
          "text-anchor": "center",
          "text-max-width": 5,
          "text-max-angle": 30,
          "text-keep-upright": true
        },
        paint: {
          "text-color": "rgba(0, 61, 132, 1)",
          "text-halo-color": "rgba(247, 246, 246, 1)",
          "text-halo-width": 0.7
        }
      });

      /* BALTI */
      /* polygon-balti-ro */
      map.addLayer({
        id: "polygon-balti-ro",
        type: "fill",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        minzoom: 8,
        filter: baltiFilter,
        paint: {
          "fill-opacity": 0.7,
          "fill-color": [
            "case",
            ["boolean", ["feature-state", "selected"], false],
            "rgba(239, 111, 108, 1)",
            "rgba(7, 91, 139, 1)",
          ],

        },
      }, "roads-track");

      /* point-balti-ro */
      map.addLayer({
        id: "point-balti-ro",
        type: "circle",
        source: SOURCE_NAME,
        "source-layer": DATA_LAYER,
        filter: baltiPointFilter,
        paint: {
          "circle-color": "#0475c1",//["case", ["to-boolean", ["get", "published"]], "#0475c1", "#AAA"],
          "circle-stroke-width": 2,
          "circle-stroke-color": "rgba(250, 247, 247, 1)",
          "circle-radius": 6
        },
      });

      /* point-balti-ro-text */
      map.addLayer({
        id: "point-balti-ro-text",
        type: "symbol",
        source: SOURCE_NAME,
        minzoom: 8,
        "source-layer": DATA_LAYER,
        filter: baltiPointFilter,
        layout: {
          "text-font": ["Roboto Black"],
          "text-field": "{nume}",
          "text-size": {
            type: "exponential",
            stops: [[8, 9], [18, 15]]
          },
          "text-allow-overlap": false,
          "text-ignore-placement": false,
          "text-letter-spacing": 0.1,
          "text-anchor": "top",
          "text-rotate": 0,
          "text-transform": "none",
          "text-offset": [0, 1]
        },
        paint: {
          "text-color": "rgba(0, 61, 132, 1)",
          "text-halo-color": "rgba(247, 246, 246, 1)",
          "text-halo-width": 0.7,
        }
      });

    });
  </script>
</body>

</html>